<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9kilo5 - Live Sports</title>
    <meta name="theme-color" content="#0f3460">
    <link rel="manifest" href="manifest.json">
    
    <!-- ==================== CSS STYLES ==================== -->
    <style>
    /* 9kilos Stream - Optimized CSS */
    :root {
        --primary-bg: linear-gradient(135deg, #0a0a1a 0%, #0f3460 50%, #1a1a2e 100%);
        --header-bg: rgba(15, 52, 96, 0.95);
        --card-bg: rgba(255, 255, 255, 0.08);
        --accent-gold: #ffd93d;
        --accent-red: #ff0000;
        --text-primary: #ffffff;
        --text-secondary: rgba(255, 255, 255, 0.8);
        --text-muted: rgba(255, 255, 255, 0.6);
        --border-light: rgba(255, 255, 255, 0.1);
    }
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%;background:var(--primary-bg);color:var(--text-primary);font-family:system-ui,-apple-system,sans-serif;line-height:1.6}
    .stream-central-dashboard{min-height:100vh;display:flex;flex-direction:column}
    .dashboard-header{text-align:center;padding:20px;background:var(--header-bg);border-bottom:1px solid var(--border-light)}
    .dashboard-header h1{margin:0 0 8px 0;font-size:2.5em;background:linear-gradient(45deg,#ff6b6b,#ffd93d,#6bcf7f,#3498db);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;font-weight:800}
    .dashboard-header p{color:var(--text-secondary);font-size:1.1em;margin:0}
    .analytics-overview{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin:20px;flex-shrink:0}
    .stat-card{background:var(--card-bg);padding:15px 10px;border-radius:12px;text-align:center;backdrop-filter:blur(15px);border:1px solid var(--border-light)}
    .stat-value{font-size:1.6em;font-weight:700;margin-bottom:4px;color:var(--accent-gold)}
    .stat-label{color:var(--text-muted);font-size:0.75em;text-transform:uppercase;letter-spacing:0.5px;font-weight:600}
    .main-content{flex:1;display:flex;flex-direction:column;min-height:0}
    #dynamic-content{flex:1;display:flex;flex-direction:column}
    .main-menu{flex:1;display:flex;flex-direction:column;justify-content:center;padding:30px 20px;gap:20px}
    .menu-grid{display:flex;flex-direction:column;gap:20px;max-width:450px;margin:0 auto;width:100%}
    .menu-button{background:linear-gradient(145deg,rgba(255,255,255,0.12),rgba(255,255,255,0.08));border:1px solid var(--border-light);border-radius:16px;padding:30px 25px;text-align:center;cursor:pointer;transition:all 0.3s ease;backdrop-filter:blur(20px)}
    .menu-button:hover{transform:translateY(-2px);border-color:var(--accent-gold)}
    .button-title{font-size:2em;font-weight:800;color:white;margin-bottom:8px}
    .button-subtitle{font-size:1em;color:rgba(255,255,255,0.8)}
    .content-section{flex:1;display:flex;flex-direction:column;padding:25px 20px;min-height:0;overflow-y:auto}
    .navigation-buttons{display:flex;gap:12px;margin-bottom:25px;align-items:center;flex-shrink:0}
    .home-button,.top-back-button{background:rgba(255,255,255,0.1);border:1px solid var(--border-light);color:var(--text-primary);padding:12px;border-radius:12px;cursor:pointer;font-size:1.3em;width:44px;height:44px;display:flex;align-items:center;justify-content:center}
    .section-header{text-align:center;margin-bottom:30px;flex-shrink:0}
    .section-header h2{margin:0 0 10px 0;font-size:2.2em;color:var(--accent-gold);font-weight:700}
    .section-header p{color:var(--text-secondary);font-size:1.2em;margin:0}
    .sports-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;flex:1;align-content:start}
    .sport-button,.date-button{background:linear-gradient(145deg,rgba(255,255,255,0.1),rgba(255,255,255,0.06));border:1px solid var(--border-light);border-radius:14px;padding:25px 20px;cursor:pointer;transition:all 0.3s ease;min-height:100px;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;backdrop-filter:blur(15px)}
    .sport-button:hover,.date-button:hover{transform:translateY(-2px);border-color:var(--accent-gold)}
    .sport-name,.date-name{font-size:1.6em;font-weight:700;color:white;margin-bottom:6px}
    .match-count{font-size:0.8em;color:rgba(255,255,255,0.6);background:rgba(255,255,255,0.08);padding:3px 10px;border-radius:8px}
    .matches-table{background:rgba(255,255,255,0.03);border-radius:12px;border:1px solid var(--border-light);overflow:hidden;flex-shrink:0;margin:0 10%}
    .table-header{display:grid;grid-template-columns:90px 1fr 100px;background:rgba(255,255,255,0.08);padding:20px 25px;border-bottom:1px solid var(--border-light);font-weight:600;font-size:1.4em;gap:20px}
    .match-row{display:grid;grid-template-columns:90px 1fr 100px;padding:18px 25px;border-bottom:1px solid rgba(255,255,255,0.05);align-items:center;gap:20px}
    .match-row.live{background:rgba(255,0,0,0.1);border-left:3px solid var(--accent-red)}
    .match-time{font-weight:600;color:var(--accent-gold);font-size:1.4em}
    .team-names{font-weight:600;color:var(--text-primary);margin-bottom:6px;font-size:1.54em}
    .league-name{color:var(--text-muted);font-size:1.26em}
    .watch-btn{background:var(--accent-gold);color:#000;border:none;padding:12px 20px;border-radius:18px;cursor:pointer;font-weight:700;font-size:1.26em;min-width:90px;transition:all 0.3s ease}
    .watch-btn.live{background:#ff0000;color:white;animation:pulse 2s infinite}
    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(255,0,0,0.7)}70%{box-shadow:0 0 0 8px rgba(255,0,0,0)}100%{box-shadow:0 0 0 0 rgba(255,0,0,0)}}
    .match-details-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--primary-bg);z-index:1000;overflow-y:auto}
    .match-details-modal{min-height:100vh;display:flex;flex-direction:column;background:rgba(15,23,42,0.98)}
    .video-player-wrapper{max-width:1200px;margin:0 auto;padding:0 20px}
    .video-player{background:#000;position:relative;min-height:400px;border-radius:12px;overflow:hidden;margin:20px 0}
    .stream-iframe{width:100%;height:500px;border:none;background:#000}
    .dashboard-footer{text-align:center;padding:25px 20px;color:var(--text-muted);border-top:1px solid var(--border-light);background:rgba(10,10,20,0.98);backdrop-filter:blur(20px);flex-shrink:0;margin-top:auto}
    .loading-message,.error-message{text-align:center;padding:60px 20px;color:var(--text-secondary)}
    .loading-spinner{border:3px solid var(--border-light);border-top:3px solid var(--accent-gold);border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin:0 auto 20px}
    @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    .retry-btn{background:var(--accent-gold);color:#000;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;font-weight:600;margin-top:15px;transition:all 0.3s ease}
    .retry-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(255,217,61,0.3)}
    .error-message h3{color:var(--accent-gold);margin-bottom:15px;font-size:1.4em}
    .favorite-btn{background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:1.2em;transition:all 0.3s ease}
    .favorite-btn.active{color:var(--accent-gold)}

    /* Mobile Optimizations */
    @media (max-width:768px){
        .dashboard-header{padding:15px}
        .dashboard-header h1{font-size:2em}
        .analytics-overview{grid-template-columns:repeat(2,1fr);margin:15px;gap:10px}
        .stat-card{padding:12px 8px}
        .stat-value{font-size:1.4em}
        .main-menu{padding:20px 15px;gap:15px}
        .menu-button{padding:25px 20px}
        .button-title{font-size:1.8em}
        .content-section{padding:20px 15px}
        .section-header h2{font-size:1.8em}
        .sports-grid{grid-template-columns:1fr;gap:12px}
        .sport-button,.date-button{padding:22px 18px;min-height:90px}
        .sport-name,.date-name{font-size:1.4em}
        .matches-table{margin:0 5%;font-size:0.8em}
        .table-header{grid-template-columns:70px 1fr 85px;padding:16px 18px;font-size:1em;gap:12px}
        .match-row{grid-template-columns:70px 1fr 85px;padding:14px 18px;gap:12px}
        .match-time{font-size:1em}
        .team-names{font-size:1.1em;line-height:1.2}
        .league-name{font-size:0.9em}
        .watch-btn{padding:10px 16px;font-size:0.9em;min-width:70px}
        .video-player-wrapper{padding:0 15px}
        .stream-iframe{height:300px}
        .dashboard-footer{padding:20px 15px}
    }
    @media (max-width:480px){
        .matches-table{margin:0 2%;font-size:0.75em}
        .table-header{grid-template-columns:60px 1fr 70px;padding:12px 15px}
        .match-row{grid-template-columns:60px 1fr 70px;padding:10px 15px}
        .team-names{font-size:1em}
        .watch-btn{min-width:60px}
    }
    </style>
</head>
<body>
    <!-- ==================== HTML STRUCTURE ==================== -->
    <div class="stream-central-dashboard">
        <header class="dashboard-header">
            <h1>9kilo14 Stream</h1>
            <p>Live Sports Schedules</p>
        </header>
        
        <div class="analytics-overview">
            <div class="stat-card"><div class="stat-value" id="live-viewers">0</div><div class="stat-label">Live Viewers</div></div>
            <div class="stat-card"><div class="stat-value" id="total-streams">0</div><div class="stat-label">Active Matches</div></div>
            <div class="stat-card"><div class="stat-value" id="countries">1</div><div class="stat-label">Countries</div></div>
            <div class="stat-card"><div class="stat-value" id="uptime">100%</div><div class="stat-label">System Status</div></div>
        </div>

        <main class="main-content">
            <div id="dynamic-content">
                <div class="main-menu">
                    <div class="menu-grid">
                        <div class="menu-button sports-button" onmouseover="matchScheduler.preloadSportsData()" onclick="matchScheduler.showSportsView()">
                            <div class="button-title">LIVE SPORTS</div>
                            <div class="button-subtitle">Games & schedules</div>
                        </div>
                        <div class="menu-button tv-button" onclick="matchScheduler.showTVChannels()">
                            <div class="button-title">TV CHANNELS</div>
                            <div class="button-subtitle">24/7 live streams</div>
                        </div>
                        <div class="menu-button community" onclick="matchScheduler.showCommunity()">
                            <div class="button-title">COMMUNITY</div>
                            <div class="button-subtitle">Fan discussions</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="dashboard-footer">
            <div class="footer-legal">
                <p class="copyright">© 2025 9KILOS. All rights reserved.</p>
                <p class="legal-disclaimer">KILOS is simply a database of embedded streams and HLS files available throughout the internet. WE does not host, control or upload any streams and/or media files.</p>
            </div>
            <div class="last-updated">Updated: <span id="update-time">Just now</span></div>
        </footer>
    </div>

    <!-- ==================== JAVASCRIPT CODE ==================== -->
    <script>
    // 9kilos Stream - Optimized JavaScript
    class MatchScheduler {
        constructor() {
            this.allMatches = [];
            this.currentView = 'main';
            this.currentSport = null;
            this.currentDate = null;
            this.verifiedMatches = [];
            this.matchStats = new Map();
            this.currentStreams = new Map();
            this.favorites = new Set(JSON.parse(localStorage.getItem('9kilos-fav')||'[]'));
            this.isDataLoaded = false;
            this.isLoading = false;
            this.cacheKey = '9kilos-cache';
            this.init();
        }
        
        async init() {
            this.showMainMenu();
            this.setupEventListeners();
        }
        
        setupEventListeners() {
            let startX = 0;
            document.addEventListener('touchstart', e => {
                startX = e.touches[0].clientX;
            });
            document.addEventListener('touchend', e => {
                if (Math.abs(e.changedTouches[0].clientX - startX) > 50) {
                    if (e.changedTouches[0].clientX < startX) this.swipeLeft();
                    else this.swipeRight();
                }
            });
        }
        
        swipeLeft() {
            if (this.currentView === 'matches') this.showDatesView();
            else if (this.currentView === 'dates') this.showSportsView();
        }
        
        swipeRight() {
            if (this.currentView === 'sports') this.showDatesView();
            else if (this.currentView === 'dates') this.showMatchesView();
        }
        
        async ensureDataLoaded() {
            if (this.isDataLoaded) return true;
            if (this.isLoading) return new Promise(r => {
                const i = setInterval(() => {
                    if (this.isDataLoaded) { clearInterval(i); r(true); }
                }, 100);
            });
            
            this.isLoading = true;
            try {
                await this.loadMatches();
                this.isDataLoaded = true;
                return true;
            } catch (e) {
                console.error('Load failed:', e);
                return false;
            } finally {
                this.isLoading = false;
            }
        }
        
        async loadMatches() {
            const cached = this.getCachedData();
            if (cached) { this.organizeMatches(cached); return; }
            
            try {
                const apiData = await this.tryAllProxies();
                this.organizeMatches(apiData);
                this.cacheData(apiData);
            } catch (e) {
                console.warn('API failed:', e);
                this.useFallbackData();
            }
        }
        
        getCachedData() {
            try {
                const c = localStorage.getItem(this.cacheKey);
                if (!c) return null;
                const {data,t} = JSON.parse(c);
                return (Date.now() - t < 300000) ? data : null;
            } catch { return null; }
        }
        
        cacheData(data) {
            try {
                localStorage.setItem(this.cacheKey, JSON.stringify({
                    data: data,
                    t: Date.now()
                }));
            } catch {}
        }
        
        async tryAllProxies() {
            const url = 'https://topembed.pw/api.php?format=json';
            const proxies = [
                `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
                `https://corsproxy.io/?${encodeURIComponent(url)}`,
                url
            ];
            
            for (const proxy of proxies) {
                try {
                    const controller = new AbortController();
                    const timeout = setTimeout(() => controller.abort(), 4000);
                    const response = await fetch(proxy, {signal: controller.signal});
                    clearTimeout(timeout);
                    if (response.ok) return await response.json();
                } catch { continue; }
            }
            throw new Error('All proxies failed');
        }
        
        useFallbackData() {
            const now = Math.floor(Date.now() / 1000);
            this.organizeMatches({
                events: {
                    '2024-12-20': [{
                        match: 'Demo Team A - Demo Team B',
                        tournament: '9kilos Research',
                        sport: 'football',
                        unix_timestamp: now + 3600,
                        channels: []
                    }]
                }
            });
        }
        
        organizeMatches(data) {
            if (!data?.events) { this.useFallbackData(); return; }
            this.allMatches = []; this.verifiedMatches = [];
            Object.entries(data.events).forEach(([date, matches]) => {
                if (Array.isArray(matches)) matches.forEach(match => {
                    if (match?.match) {
                        const id = this.generateMatchId(match);
                        if (!this.matchStats.has(id)) {
                            this.matchStats.set(id, {
                                views: Math.floor(Math.random() * 10000) + 500,
                                likes: Math.floor(Math.random() * 500) + 50
                            });
                        }
                        const channels = match.channels || [];
                        if (channels.length > 0 && !this.currentStreams.has(id)) {
                            this.currentStreams.set(id, 0);
                        }
                        this.verifiedMatches.push({
                            id: id, date: date, time: this.convertTime(match.unix_timestamp),
                            teams: match.match, league: match.tournament || match.sport || 'Sports',
                            streamUrl: channels[0] || null, channels: channels,
                            isLive: this.checkIfLive(match), sport: this.classifySport(match),
                            unixTimestamp: match.unix_timestamp
                        });
                    }
                });
            });
            if (this.verifiedMatches.length === 0) { this.useFallbackData(); return; }
            this.verifiedMatches.sort((a, b) => a.unixTimestamp - b.unixTimestamp);
            this.updateAnalytics();
            if (this.currentView !== 'main') {
                this[`show${this.currentView.charAt(0).toUpperCase() + this.currentView.slice(1)}View`]();
            }
        }
        
        classifySport(match) {
            const sport = (match.sport || '').toLowerCase();
            const tournament = (match.tournament || '').toLowerCase();
            const map = {
                football: 'football', soccer: 'football', hockey: 'hockey',
                basketball: 'basketball', tennis: 'tennis', cricket: 'cricket'
            };
            if (sport && map[sport]) return map[sport];
            for (const [key, value] of Object.entries(map)) {
                if (sport.includes(key) || tournament.includes(key)) return value;
            }
            return 'other';
        }
        
        generateMatchId(match) {
            return `${match.match}-${match.unix_timestamp}-${Math.random().toString(36).substr(2,6)}`;
        }
        
        convertTime(timestamp) {
            if (!timestamp) return 'TBD';
            return new Date(timestamp * 1000).toLocaleTimeString('en-US', {
                hour: '2-digit', minute: '2-digit', hour12: false
            });
        }
        
        checkIfLive(match) {
            if (!match.unix_timestamp) return false;
            const now = Math.floor(Date.now() / 1000);
            return now >= match.unix_timestamp && now <= (match.unix_timestamp + 7200);
        }
        
        formatTeamNames(teamString) { 
            return teamString.replace(/ - /g, ' vs '); 
        }
        
        formatNumber(num) { 
            if (num >= 1000000) return (num/1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num/1000).toFixed(1) + 'K';
            return num.toString();
        }
        
        showMainMenu() {
            this.showInDynamic(`
                <div class="main-menu">
                    <div class="menu-grid">
                        <div class="menu-button sports-button" onmouseover="matchScheduler.preloadSportsData()" onclick="matchScheduler.showSportsView()">
                            <div class="button-title">LIVE SPORTS</div>
                            <div class="button-subtitle">${this.isDataLoaded ? this.verifiedMatches.length + ' matches' : 'Games & schedules'}</div>
                        </div>
                        <div class="menu-button tv-button" onclick="matchScheduler.showTVChannels()">
                            <div class="button-title">TV CHANNELS</div>
                            <div class="button-subtitle">24/7 live streams</div>
                        </div>
                        <div class="menu-button community" onclick="matchScheduler.showCommunity()">
                            <div class="button-title">COMMUNITY</div>
                            <div class="button-subtitle">Fan discussions</div>
                        </div>
                    </div>
                </div>
            `);
            this.showStats(); 
            this.currentView = 'main';
        }
        
        async showSportsView() {
            if (!await this.ensureDataLoaded()) return;
            const sports = ['football','hockey','basketball','tennis','cricket','other']
                .map(sport => ({
                    id: sport, 
                    name: sport.charAt(0).toUpperCase() + sport.slice(1), 
                    count: this.getMatchesBySport(sport).length
                }))
                .filter(sport => sport.count > 0);
            
            this.showInDynamic(`
                <div class="content-section">
                    <div class="navigation-buttons">
                        <button class="home-button" onclick="matchScheduler.showMainMenu()">⌂</button>
                    </div>
                    <div class="section-header">
                        <h2>Choose Sport</h2>
                        <p>Select category</p>
                    </div>
                    <div class="sports-grid">
                        ${sports.map(sport => `
                            <div class="sport-button" onclick="matchScheduler.selectSport('${sport.id}')">
                                <div class="sport-name">${sport.name}</div>
                                <div class="match-count">${sport.count} matches</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `);
            this.hideStats(); 
            this.currentView = 'sports';
        }
        
        async showDatesView() {
            await this.ensureDataLoaded();
            const matches = this.getMatchesBySport(this.currentSport);
            const dates = [...new Set(matches.map(match => match.date))].sort();
            const sportName = this.currentSport.charAt(0).toUpperCase() + this.currentSport.slice(1);
            
            this.showInDynamic(`
                <div class="content-section">
                    <div class="navigation-buttons">
                        <button class="home-button" onclick="matchScheduler.showMainMenu()">⌂</button>
                        <button class="top-back-button" onclick="matchScheduler.showSportsView()">←</button>
                    </div>
                    <div class="section-header">
                        <h2>${sportName}</h2>
                        <p>Select date</p>
                    </div>
                    <div class="sports-grid">
                        ${dates.map(date => {
                            const dateMatches = matches.filter(m => m.date === date);
                            const liveCount = dateMatches.filter(m => m.isLive).length;
                            return `
                                <div class="date-button" onclick="matchScheduler.selectDate('${date}')">
                                    <div class="date-name">${this.formatDisplayDate(date)}</div>
                                    <div class="match-count">${dateMatches.length} match${dateMatches.length !== 1 ? 'es' : ''}${liveCount > 0 ? ` • ${liveCount} live` : ''}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `);
            this.hideStats(); 
            this.currentView = 'dates';
        }
        
        async showMatchesView() {
            await this.ensureDataLoaded();
            const matches = this.getMatchesBySportAndDate(this.currentSport, this.currentDate);
            const sportName = this.currentSport.charAt(0).toUpperCase() + this.currentSport.slice(1);
            const displayDate = this.formatDisplayDate(this.currentDate);
            
            this.showInDynamic(`
                <div class="content-section">
                    <div class="navigation-buttons">
                        <button class="home-button" onclick="matchScheduler.showMainMenu()">⌂</button>
                        <button class="top-back-button" onclick="matchScheduler.showDatesView()">←</button>
                    </div>
                    <div class="section-header">
                        <h2>Schedule</h2>
                        <p>${displayDate}</p>
                    </div>
                    <div class="matches-table">
                        <div class="table-header">
                            <div>Time</div>
                            <div>Match</div>
                            <div>Watch</div>
                        </div>
                        ${matches.length > 0 ? 
                            matches.map(match => this.renderMatchRow(match)).join('') :
                            '<div class="no-matches">No matches found</div>'
                        }
                    </div>
                </div>
            `);
            this.hideStats(); 
            this.currentView = 'matches';
        }
        
        renderMatchRow(match) {
            const isLive = match.isLive;
            const teams = this.formatTeamNames(match.teams);
            const isFavorite = this.favorites.has(match.id) ? 'active' : '';
            
            return `
                <div class="match-row ${isLive ? 'live' : ''}">
                    <div class="match-time">${match.time}</div>
                    <div class="match-details">
                        <div class="team-names">${teams}</div>
                        <div class="league-name">${match.league}</div>
                    </div>
                    <div class="watch-action" style="display:flex;align-items:center;gap:8px">
                        <button class="favorite-btn ${isFavorite}" onclick="matchScheduler.toggleFavorite('${match.id}')" style="background:none;border:none;color:${isFavorite?'var(--accent-gold)':'var(--text-muted)'};cursor:pointer;font-size:1.2em">★</button>
                        ${match.channels?.length > 0 ? 
                            `<button class="watch-btn ${isLive ? 'live' : ''}" onclick="matchScheduler.showMatchDetails('${match.id}')">
                                ${isLive ? 'LIVE' : 'WATCH'}
                            </button>` :
                            '<span style="color:var(--text-muted);font-size:0.8em">OFFLINE</span>'
                        }
                    </div>
                </div>
            `;
        }
        
        toggleFavorite(matchId) {
            if (this.favorites.has(matchId)) {
                this.favorites.delete(matchId);
            } else {
                this.favorites.add(matchId);
            }
            localStorage.setItem('9kilos-fav', JSON.stringify([...this.favorites]));
            if (this.currentView === 'matches') this.showMatchesView();
        }
        
        async showMatchDetails(matchId) {
            await this.ensureDataLoaded();
            const match = this.verifiedMatches.find(m => m.id === matchId);
            if (!match) return;
            
            const stats = this.matchStats.get(matchId) || { views: 0, likes: 0 };
            const channels = match.channels || [];
            const currentChannel = this.currentStreams.get(matchId) || 0;
            const streamUrl = channels[currentChannel] || null;
            const isFavorite = this.favorites.has(matchId) ? 'active' : '';
            
            this.showInDynamic(`
                <div class="match-details-overlay">
                    <div class="match-details-modal">
                        <div class="match-header" style="display:flex;justify-content:space-between;align-items:center;padding:15px 20px;background:rgba(255,255,255,0.05);border-bottom:1px solid var(--border-light)">
                            <button class="back-btn" onclick="matchScheduler.showMatchesView()" style="background:rgba(255,255,255,0.1);border:1px solid var(--border-light);color:var(--text-primary);padding:8px 16px;border-radius:8px;cursor:pointer">← Back</button>
                            <button class="favorite-btn ${isFavorite}" onclick="matchScheduler.toggleFavorite('${match.id}')" style="background:none;border:none;color:${isFavorite?'var(--accent-gold)':'var(--text-muted)'};cursor:pointer;font-size:1.2em">★</button>
                        </div>
                        
                        <div class="video-container">
                            <div class="video-player-wrapper">
                                <div class="video-player" id="video-player-${matchId}">
                                    ${streamUrl ? 
                                        `<iframe src="${streamUrl}" class="stream-iframe" id="stream-iframe-${matchId}" allow="autoplay; fullscreen" allowfullscreen></iframe>` :
                                        `<div class="no-stream" style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:400px;color:var(--text-muted);text-align:center;padding:40px 20px">
                                            <h3 style="color:var(--accent-red);margin-bottom:15px;font-size:1.4em">Stream Offline</h3>
                                            <p>No streams available</p>
                                        </div>`
                                    }
                                </div>
                            </div>
                            
                            <div style="padding:25px;background:rgba(255,255,255,0.02)">
                                <div style="font-size:1.8em;font-weight:700;color:var(--text-primary);margin-bottom:12px">${this.formatTeamNames(match.teams)}</div>
                                <div style="display:flex;gap:18px;align-items:center;margin-bottom:25px;flex-wrap:wrap">
                                    <span style="color:var(--text-secondary)">${this.formatNumber(stats.views)} views</span>
                                    ${match.isLive ? '<span style="background:#ff0000;color:white;padding:6px 14px;border-radius:14px;font-size:0.9em;font-weight:600;animation:pulse 2s infinite">LIVE NOW</span>' : ''}
                                    <span style="color:var(--text-muted)">• ${match.league}</span>
                                </div>
                                
                                <div style="display:flex;gap:12px;margin-bottom:25px;flex-wrap:wrap">
                                    <button class="action-btn" onclick="matchScheduler.handleLike('${matchId}')" style="background:rgba(255,255,255,0.1);border:1px solid var(--border-light);color:var(--text-primary);padding:10px 18px;border-radius:15px;cursor:pointer;display:flex;align-items:center;gap:6px">
                                        👍 ${this.formatNumber(stats.likes)}
                                    </button>
                                    <button class="action-btn" onclick="matchScheduler.toggleFullscreen('${matchId}')" style="background:rgba(255,255,255,0.1);border:1px solid var(--border-light);color:var(--text-primary);padding:10px 18px;border-radius:15px;cursor:pointer;display:flex;align-items:center;gap:6px">
                                        ⛶ Fullscreen
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `);
            this.hideStats();
            this.incrementViews(matchId);
        }
        
        toggleFullscreen(matchId) {
            const player = document.getElementById(`video-player-${matchId}`);
            if (!player) return;
            if (!document.fullscreenElement) {
                player.requestFullscreen().catch(() => {});
            } else {
                document.exitFullscreen();
            }
        }
        
        handleLike(matchId) {
            const stats = this.matchStats.get(matchId);
            if (stats) {
                stats.likes++;
                this.matchStats.set(matchId, stats);
                this.showMatchDetails(matchId);
            }
        }
        
        incrementViews(matchId) {
            const stats = this.matchStats.get(matchId);
            if (stats) stats.views++;
        }
        
        showInDynamic(html) {
            document.getElementById('dynamic-content').innerHTML = html;
        }
        
        showStats() { 
            document.querySelector('.analytics-overview').style.display = 'grid'; 
        }
        
        hideStats() { 
            document.querySelector('.analytics-overview').style.display = 'none'; 
        }
        
        preloadSportsData() {
            if (this.isDataLoaded || this.isLoading) return;
            setTimeout(() => { this.loadMatches().catch(() => {}); }, 500);
        }
        
        selectSport(sport) { 
            this.currentSport = sport; 
            this.showDatesView(); 
        }
        
        selectDate(date) { 
            this.currentDate = date; 
            this.showMatchesView(); 
        }
        
        getMatchesBySport(sport) { 
            return this.verifiedMatches.filter(match => match.sport === sport); 
        }
        
        getMatchesBySportAndDate(sport, date) { 
            return this.getMatchesBySport(sport).filter(match => match.date === date); 
        }
        
        formatDisplayDate(dateString) {
            return new Date(dateString + 'T00:00:00').toLocaleDateString('en-US', {
                weekday: 'short', month: 'short', day: 'numeric'
            });
        }
        
        updateAnalytics() {
            const liveMatches = this.verifiedMatches.filter(match => match.isLive).length;
            const totalViewers = this.verifiedMatches.reduce((sum, match) => {
                const stats = this.matchStats.get(match.id);
                return sum + (stats ? stats.views : 0);
            }, 0);
            
            document.getElementById('total-streams').textContent = this.verifiedMatches.length;
            document.getElementById('live-viewers').textContent = this.formatNumber(Math.floor(totalViewers / 100));
            document.getElementById('update-time').textContent = new Date().toLocaleTimeString();
        }
        
        showTVChannels() {
            this.showInDynamic(`
                <div class="content-section">
                    <div class="navigation-buttons">
                        <button class="home-button" onclick="matchScheduler.showMainMenu()">⌂</button>
                    </div>
                    <div class="section-header">
                        <h2>TV Channels</h2>
                        <p>24/7 live streams</p>
                    </div>
                    <div class="sports-grid">
                        <div class="sport-button" onclick="alert('Coming soon!')">
                            <div class="sport-name">Sky Sports</div>
                            <div class="match-count">Sports</div>
                        </div>
                        <div class="sport-button" onclick="alert('Coming soon!')">
                            <div class="sport-name">ESPN</div>
                            <div class="match-count">Sports</div>
                        </div>
                    </div>
                </div>
            `);
            this.hideStats();
        }
        
        showCommunity() {
            this.showInDynamic(`
                <div class="content-section">
                    <div class="navigation-buttons">
                        <button class="home-button" onclick="matchScheduler.showMainMenu()">⌂</button>
                    </div>
                    <div class="section-header">
                        <h2>Community</h2>
                        <p>Fan discussions</p>
                    </div>
                    <div class="sports-grid">
                        <div class="sport-button" onclick="alert('Coming soon!')">
                            <div class="sport-name">Fan Zone</div>
                            <div class="match-count">Live Chat</div>
                        </div>
                        <div class="sport-button" onclick="alert('Coming soon!')">
                            <div class="sport-name">Match Reactions</div>
                            <div class="match-count">Community</div>
                        </div>
                    </div>
                </div>
            `);
            this.hideStats();
        }
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', () => {
        window.matchScheduler = new MatchScheduler();
    });

    // PWA Service Worker
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js').catch(() => {});
    }
    </script>
</body>
</html>
